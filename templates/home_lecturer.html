<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Smart Campus â€“ ××¨×¦×”</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='home_screen.css') }}">
</head>
<body>

<header class="top">
  <a class="logout-btn" href="{{ url_for('logout') }}" aria-label="×™×¦×™××”" title="×™×¦×™××”">
    <img src="{{ url_for('static', filename='exit.png') }}" alt="×™×¦×™××”">
  </a>

  <div class="brand">Smart Campus</div>

  <div class="user">
    <div class="user__line">×©×: <span class="muted">{{ user_name }}</span></div>
    <div class="user__line">×¡×™×•×•×’: <span class="muted">{{ role }}</span></div>
  </div>
</header>

<main class="layout">
<section class="main">

<!-- ×”×“×™×•×•×—×™× ×©×œ×™ -->
<div class="panel">
<h2 class="panel__title">×”×“×™×•×•×—×™× ×©×œ×™:</h2>

<div class="rows">
{% if reports and reports|length > 0 %}
  {% for r in reports %}
    <div class="row">
      {% set st = r["status"] %}
      <span class="status {{ 'status--done' if st == 'done' else 'status--open' }}">
        {{ '×˜×•×¤×œ' if st == 'done' else '×‘×˜×™×¤×•×œ' }}
      </span>
      <div class="row__text">
        ×›×™×ª×”: {{ r["room"] }} - {{ r["description"] }}
      </div>
    </div>
  {% endfor %}
{% else %}
  <div class="row"><div class="row__text muted">××™×Ÿ ×“×™×•×•×—×™× ×¢×“×™×™×Ÿ</div></div>
{% endif %}
</div>
</div>

<!-- ×›×™×ª×•×ª ×©×ª×¤×¡×ª×™ -->
<div class="panel">
<h2 class="panel__title">×›×™×ª×•×ª ×©×ª×¤×¡×ª×™:</h2>

<div class="rows rows--tight">
{% if taken and taken|length > 0 %}
  {% for t in taken %}
    {% if t["status"] == "active" %}
    <div class="row row--x">
      <button class="xbtn" data-res-id="{{ t['id'] }}">X</button>
      <div class="row__text">
        ×›×™×ª×”: {{ t["room"] }} |
        ×ª××¨×™×š: {{ t["date"] }} |
        ×©×¢×•×ª: {{ t["start_time"] }}-{{ t["end_time"] }}
      </div>
    </div>
    {% endif %}
  {% endfor %}
{% else %}
  <div class="row"><div class="row__text muted">××™×Ÿ ×©×¨×™×•× ×™× ×¢×“×™×™×Ÿ</div></div>
{% endif %}
</div>

<p class="hint">×× × ×©×—×¨×¨ ××ª ×”×›×™×ª×” ×‘××™×“×” ×•×™×¦××ª ×œ×¤× ×™ ×”×–××Ÿ :)</p>
</div>

</section>

<aside class="side">
<div class="side__title">×ª×¤×¨×™×˜:</div>

<a class="side__item" href="/reservations/lecturer">
  <div class="side__icon">ğŸ”</div>
  <div class="side__label">×—×™×¤×•×© ×›×™×ª×” ×¤× ×•×™×”</div>
</a>

<a class="side__item" href="/reports/new">
  <div class="side__icon">â—</div>
  <div class="side__label">×“×™×•×•×— ×¢×œ ×ª×§×œ×”</div>
</a>
</aside>
</main>

<img class="corner-logo" src="{{ url_for('static', filename='app_logo.png') }}" alt="Smart Campus Logo" />

<!-- Modal ×‘×™×˜×•×œ ×©×¨×™×•×Ÿ -->
<div class="modal-overlay" id="cancelOverlay" hidden>
  <div class="modal">
    <h3 class="modal__title">×œ×‘×˜×œ ×©×¨×™×•×Ÿ?</h3>
    <p class="modal__text">×”×× ××ª×” ×‘×˜×•×— ×©××ª×” ×¨×•×¦×” ×œ×‘×˜×œ ××ª ×©×¨×™×•×Ÿ ×”×›×™×ª×”?</p>

    <form id="cancelForm" method="POST">
      <div class="modal__actions">
        <button type="button" class="btn btn--ghost" id="cancelNo">×œ×</button>
        <button type="submit" class="btn btn--danger">×›×Ÿ, ×œ×‘×˜×œ</button>
      </div>
    </form>
  </div>
</div>

<script>
const cancelOverlay = document.getElementById("cancelOverlay");
const cancelForm = document.getElementById("cancelForm");
const cancelNo = document.getElementById("cancelNo");

cancelOverlay.hidden = true;

document.querySelectorAll(".xbtn[data-res-id]").forEach(btn => {
  btn.addEventListener("click", () => {
    const id = btn.dataset.resId;
    cancelForm.action = `/reservations/cancel/${id}`;
    cancelOverlay.hidden = false;
  });
});

cancelNo.addEventListener("click", () => cancelOverlay.hidden = true);

cancelOverlay.addEventListener("click", e => {
  if (e.target === cancelOverlay) cancelOverlay.hidden = true;
});
</script>

<!-- Modal ×”×•×“×¢×ª ×”×¦×œ×—×” (×¨×§ ×”×˜×§×¡×˜ ××”-app.py) -->
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <div class="modal-overlay" id="infoOverlay">
      <div class="modal">
        <p class="modal__text">{{ messages[-1] }}</p>

        <div class="modal__actions">
          <button class="btn btn--ghost" id="closeInfoBtn">×”×‘× ×ª×™</button>
        </div>
      </div>
    </div>

    <script>
      const infoOverlay = document.getElementById("infoOverlay");
      const closeBtn = document.getElementById("closeInfoBtn");

      function closeInfoModal(){
        infoOverlay.remove();
      }

      closeBtn.addEventListener("click", closeInfoModal);

      infoOverlay.addEventListener("click", (e) => {
        if (e.target === infoOverlay) closeInfoModal();
      });
    </script>
  {% endif %}
{% endwith %}

</body>
</html>
